# Test cases for bogus BogusCiA402Device
#
# Drive init, automatic
# CiA 301 NMT init -> operational; CiA 402 START -> SWITCH ON DISABLED
#
- desc:  "Init:  301 NMT state machine init"
  feedback_in:
    # CiA 301
    online:  False
    oper:  False
    # CiA 402:  Default values before NMT operational
    status_word:  0x0000
    control_mode_fb:  0  # Undefined
    position_cmd:  0
    position_fb:  0
    # STO
    sto:  False
    # errors
    error_code:  0x00000000
  feedback_out:
    # CiA 301
    online:  False
    oper:  False
    # CiA 402:  Default values before NMT operational
    status_word:  0x0000
    control_mode_fb:  0  # Undefined
    state:  START
    transition:  -1
    home_success:  False
    home_error:  False
    fault:  False
    goal_reached:  False
    goal_reason:  Offline
    move_success:  False
    move_error:  False
    position_cmd:  0
    position_fb:  0
    # STO
    sto:  False
    # errors
    error_code:  0x00000000
    description: No error
    advice: No error
    fault_desc: ""
  command_in:
    # CiA 301
    online:  True
    oper:  True
    # CiA 402
    state:  SWITCH ON DISABLED
    control_mode:  8  # MODE_CSP
    home_request:  False
    move_request:  False
  command_out:
    # CiA 402
    control_word:  0x0000
    control_mode:  8  # MODE_CSP
  sim_feedback:
    # CiA 301
    online:  True
    oper:  False
    # CiA 402:  Default values before NMT operational
    status_word:  0x0000  # START
    control_mode_fb:  0  # Undefined
    position_cmd:  0.0
    position_fb:  0.0
    # STO
    sto:  False
    # errors
    error_code:  0x00000000
- desc:  "Init:  301 NMT state machine pre-op"
  feedback_in:
    # CiA 301
    online:  True
  feedback_out:
    # CiA 301
    online:  True
    goal_reason:  Not operational
  sim_feedback:
    # CiA 301
    oper:  True
    # CiA 402:
    status_word:  0x0010  # VOLTAGE_ENABLED
- desc:  "Init:  301 NMT state machine operational; 402 state machine transition 0"
  feedback_in:
    # CiA 301
    oper:  True
    # CiA 402:
    status_word:  0x0010  # VOLTAGE_ENABLED
  feedback_out:
    # CiA 301
    oper:  True
    # CiA 402
    status_word:  0x0010  # VOLTAGE_ENABLED
    state:  'NOT READY TO SWITCH ON'
    transition:  0
    goal_reason:  control_mode MODE_NA != MODE_CSP; state NOT READY TO SWITCH ON (0x00000010) != SWITCH ON DISABLED
  sim_feedback:
    # CiA 402
    status_word:  0x0050   # SWITCH ON DISABLED + VOLTAGE_ENABLED
    control_mode_fb:  8  # MODE_CSP
- desc:  "Init:  402 state machine transition 1"
  feedback_in:
    status_word:  0x0050   # SWITCH ON DISABLED + VOLTAGE_ENABLED
    control_mode_fb:  8  # MODE_CSP
  feedback_out:
    status_word:  0x0050   # SWITCH ON DISABLED + VOLTAGE_ENABLED
    control_mode_fb:  8  # MODE_CSP
    state:  SWITCH ON DISABLED
    transition:  1
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Init:  Hold state x1"
  feedback_out:
    transition:  -1
- desc:  "Init:  Hold state x2"

#
# Enable drive
# CiA 402 SWITCH ON DISABLED -> OPERATION ENABLED
#
- desc:  "Enable:  OPERATION ENABLED; 402 state machine transition hold"
  command_in:
    # Controller commands OPERATION ENABLED
    state:  OPERATION ENABLED
  command_out:
    control_word:  0x0006
  sim_feedback:
    status_word:  0x0031
- desc:  "Enable:  402 state machine transition 2"
  feedback_in:
    status_word:  0x0031
  feedback_out:
    status_word:  0x0031
    state:  READY TO SWITCH ON
    transition:  2
    goal_reached:  False
    goal_reason:  state READY TO SWITCH ON (0x00000031) != OPERATION ENABLED
  command_out:
    control_word:  0x0007
  sim_feedback:
    status_word:  0x0033
- desc:  "Enable:  402 state machine transition 3"
  feedback_in:
    status_word:  0x0033
  feedback_out:
    status_word:  0x0033
    state:  SWITCHED ON
    transition:  3
    goal_reason:  state SWITCHED ON (0x00000033) != OPERATION ENABLED
  command_out:
    control_word:  0x000F
  sim_feedback:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
- desc:  "Enable:  402 state machine transition 4"
  feedback_in:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    state:  OPERATION ENABLED
    transition:  4
    goal_reached:  True
    goal_reason:  Reached

#
# Simulate fault and automatic recovery
# (In real life, upper layers would hold fault)
# OPERATION ENABLED -> FAULT -> SWITCH ON DISABLED -> (towards) OPERATION ENABLED
#
- desc:  "Sim fault:  Fault;  402 state machine transition 13"
  sim_feedback_set:
    # Simulate the fault
    status_word:  0x001F  # FAULT REACTION ACTIVE
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_in:
    status_word:  0x001F
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_out:
    status_word:  0x001F
    state:  FAULT REACTION ACTIVE
    transition:  13
    fault:  True
    fault_desc:  Unknown error code 0xDEADBEEF
    goal_reached:  False
    goal_reason:  state FAULT REACTION ACTIVE (0x0000001F) != OPERATION ENABLED; Unknown error code 0xDEADBEEF
    error_code:  0xDEADBEEF  # Bogus error code
    description:  Unknown error code 0xDEADBEEF
    advice:  Contact technical support
  command_out:
    control_word:  0x0000
  sim_feedback:
    status_word:  0x0018
- desc:  "Sim fault:  Recover;  402 state machine transition 14"
  sim_feedback_set:
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_in:
    status_word:  0x0018
  feedback_out:
    status_word:  0x0018
    state:  FAULT
    transition:  14
    goal_reason:  state FAULT (0x00000018) != OPERATION ENABLED; Unknown error code 0xDEADBEEF
  command_out:
    # Goal is still OPERATION ENABLED, so automatically clear fault
    control_word:  0x0080  # Clear fault
  sim_feedback:
    status_word:  0x0050
- desc:  "Sim fault:  402 state machine transition 15"
  feedback_in:
    status_word:  0x0050
    error_code:  0x00000000  # Cleared by control_word 0x0080
  feedback_out:
    status_word:  0x0050
    state:  SWITCH ON DISABLED
    transition:  15
    fault:  False
    fault_desc:  ""
    goal_reason:  state SWITCH ON DISABLED (0x00000050) != OPERATION ENABLED
    error_code:  0x00000000  # Cleared by control_word 0x0080
    description:  No error
    advice:  No error
  command_out:
    control_word:  0x0006
  sim_feedback:
    status_word:  0x0031
- desc:  "Sim fault:  402 state machine transition 2"
  feedback_in:
    status_word:  0x0031
  feedback_out:
    status_word:  0x0031
    state:  READY TO SWITCH ON
    transition:  2
    goal_reason:  state READY TO SWITCH ON (0x00000031) != OPERATION ENABLED
  command_out:
    control_word:  0x0007
  sim_feedback:
    status_word:  0x0033

#
# Simulate fault during transitions to OPERATION ENABLED; command hold state
# READY TO SWITCH ON  -> FAULT -> hold
#
- desc:  "Hold fault:  Fault;  402 state machine transition 13"
  sim_feedback_set:
    status_word:  0x001F  # FAULT REACTION ACTIVE
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_in:
    status_word:  0x001F
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_out:
    status_word:  0x001F
    state:  FAULT REACTION ACTIVE
    transition:  13
    fault:  True
    fault_desc:  Unknown error code 0xDEADBEEF
    goal_reason:  state FAULT REACTION ACTIVE (0x0000001F) != OPERATION ENABLED; Unknown error code 0xDEADBEEF
    error_code:  0xDEADBEEF
    description:  Unknown error code 0xDEADBEEF
    advice:  Contact technical support
  command_out:
    control_word:  0x0000
  sim_feedback:
    status_word:  0x0018
- desc:  "Hold fault:  Goal->FAULT;  402 state machine transition 14"
  sim_feedback_set:
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_in:
    status_word:  0x0018
  feedback_out:
    status_word:  0x0018
    state:  FAULT
    transition:  14
    goal_reason:  state FAULT (0x00000018) != OPERATION ENABLED; Unknown error code 0xDEADBEEF
  command_in:
  # Controller sees FAULT state and commands hold at that state
    state:  FAULT
- desc:  "Hold fault:  Hold state x1"
  sim_feedback_set:
    error_code:  0xDEADBEEF  # Bogus error code
  feedback_out:
    transition:  -1
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Hold fault:  Hold state x2"
  sim_feedback_set:
    error_code:  0xDEADBEEF  # Bogus error code

#
# Command disable drive from FAULT
# FAULT -> SWITCH ON DISABLED
#
- desc:  "Disable:  Command disable;  402 state machine transition hold"
  sim_feedback_set:
    error_code:  0xDEADBEEF  # Bogus error code
  command_in:
    # Controller commands disable
    state:  SWITCH ON DISABLED
  command_out:
    control_word:  0x0080  # Clear fault
  sim_feedback:
    status_word:  0x0050
- desc:  "Disable:  402 state machine transition 15"
  feedback_in:
    status_word:  0x0050
    error_code:  0x00000000  # Cleared by control_word 0x0080
  feedback_out:
    status_word:  0x0050
    state:  SWITCH ON DISABLED
    fault:  False
    fault_desc:  ""
    transition:  15
    error_code:  0x00000000  # Cleared by control_word 0x0080
    description:  No error
    advice:  No error
  command_out:
    control_word:  0x0000
- desc:  "Disable:  Hold state x1"
  feedback_out:
    transition:  -1
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Disable:  Hold state x2"

#
# Controller commands FAULT in reaction to unrelated event; hold
# disabled state
#
- desc:  "Ext fault noop:  Command FAULT"
  command_in:
    # Controller commands FAULT
    state:  FAULT
- desc:  "Ext fault noop:  Hold state x1"
- desc:  "Ext fault noop:  Hold state x2"

#
# Controller commands SWITCHED ON to enable several drives in concert
#
- desc:  "Enable multi:  Command SWITCHED ON;  402 state machine transition hold"
  command_in:
    # Controller commands SWITCHED ON
    state:  SWITCHED ON
  command_out:
    control_word:  0x0006
  sim_feedback:
    status_word:  0x0031
- desc:  "Enable multi:  402 state machine transition 2"
  feedback_in:
    status_word:  0x0031
  feedback_out:
    status_word:  0x0031
    state:  READY TO SWITCH ON
    transition:  2
    goal_reached:  False
    goal_reason:  state READY TO SWITCH ON (0x00000031) != SWITCHED ON
  command_out:
    control_word:  0x0007
  sim_feedback:
    status_word:  0x0033
- desc:  "Enable multi:  402 state machine transition 3"
  feedback_in:
    status_word:  0x0033
  feedback_out:
    status_word:  0x0033
    state:  SWITCHED ON
    transition:  3
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Enable multi:  Hold SWITCHED ON while waiting for other drives x1"
  feedback_out:
    transition:  -1
- desc:  "Enable multi:  Hold SWITCHED ON while waiting for other drives x2"

#
# Controller commands OPERATION ENABLED from SWITCHED ON to enable
# several drives in concert
#
- desc:  "Enable multi:  Command OPERATION ENABLED;  402 state machine transition hold"
  command_in:
    # Controller commands OPERATION ENABLED
    state:  OPERATION ENABLED
  feedback_in:
    status_word:  0x0033
  feedback_out:
    status_word:  0x0033
    state:  SWITCHED ON
  command_out:
    control_word:  0x000F
  sim_feedback:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
- desc:  "Enable multi:  402 state machine transition 4"
  feedback_in:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    state:  OPERATION ENABLED
    transition:  4
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Enable multi:  Hold OPERATION ENABLED x1"
  feedback_out:
    transition:  -1
- desc:  "Enable multi:  Hold OPERATION ENABLED x2"

#
# Controller commands FAULT in reaction to unrelated event while drive
# enabled; command disable
# OPERATION ENABLED -> QUICK STOP ACTIVE -> SWITCH ON DISABLED
#
- desc:  "Disable enabled:  Command disable;  402 state machine transition hold"
  command_in:
    # Controller commands FAULT in response to external event
    state:  FAULT
  command_out:
    control_word:  0x0002
  sim_feedback:
    status_word:  0x0017
- desc:  "Disable enabled:  Command disable;  402 state machine transition 11"
  feedback_in:
    status_word:  0x0017
  feedback_out:
    status_word:  0x0017
    state:  QUICK STOP ACTIVE
    transition:  11
    goal_reached:  False
    goal_reason:  state QUICK STOP ACTIVE (0x00000017) != FAULT
  command_out:
    control_word:  0x0000
  sim_feedback:
    status_word:  0x0050
- desc:  "Disable enabled:  Command disable;  402 state machine transition 12"
  feedback_in:
    status_word:  0x0050
  feedback_out:
    status_word:  0x0050
    state:  SWITCH ON DISABLED
    transition:  12
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Disable disabled:  Hold SWITCH ON DISABLED x1"
  feedback_out:
    transition:  -1
- desc:  "Disable disabled:  Hold SWITCH ON DISABLED x2"

#
# Controller commands OPERATION ENABLED while no voltage at motor;
# FAULT reported
#
- desc:  "No voltage:  Command SWITCHED ON;  402 state machine transition hold"
  command_in:
    # Controller commands switched on
    state:  SWITCHED ON
  command_out:
    control_word:  0x0006
  sim_feedback:
    status_word:  0x0031  # READY TO SWITCH ON + VOLTAGE_ENABLED
- desc:  "No voltage:  402 state machine transition 2"
  sim_feedback_set:
    # Clear VOLTAGE_ENABLED; not a fault for cmd SWITCHED ON
    status_word:  0x0021  # READY TO SWITCH ON - VOLTAGE_ENABLED
  feedback_in:
    status_word:  0x0021
  feedback_out:
    status_word:  0x0021
    state:  READY TO SWITCH ON
    transition:  2
    goal_reached:  False
    goal_reason:  state READY TO SWITCH ON (0x00000021) != SWITCHED ON
  command_out:
    control_word:  0x0007
  sim_feedback:
    status_word:  0x0033  # SWITCHED ON + VOLTAGE_ENABLED
- desc:  "No voltage:  402 state machine transition 3"
  sim_feedback_set:
    # Clear VOLTAGE_ENABLED; not a fault for cmd SWITCHED ON
    status_word:  0x0023  # SWITCHED ON - VOLTAGE_ENABLED
  feedback_in:
    status_word:  0x0023
  feedback_out:
    status_word:  0x0023
    state:  SWITCHED ON
    transition:  3
    goal_reached:  True
    goal_reason:  Reached
- desc:  "No voltage:  SWITCHED ON goal reached; command OPERATION ENABLED"
  sim_feedback_set:
    # Clear VOLTAGE_ENABLED; not a fault for cmd SWITCHED ON
    status_word:  0x0023  # SWITCHED ON - VOLTAGE_ENABLED
  command_in:
    # Controller commands OPERATION ENABLED
    state:  OPERATION ENABLED
  feedback_out:
    transition:  -1
  command_out:
    control_word:  0x000F
- desc:  "No voltage:  402 state machine transition 4 fails"
  sim_feedback_set:
    # Clear VOLTAGE_ENABLED; a fault for cmd OPERATION ENABLED
    status_word:  0x0023  # SWITCHED ON - VOLTAGE_ENABLED
  feedback_out:
    fault:  True
    fault_desc:  No voltage at motor
    goal_reached:  False
    goal_reason:  state SWITCHED ON (0x00000023) != OPERATION ENABLED; No voltage at motor
- desc:  "No voltage:  Hold state"
  sim_feedback_set:
    # Clear VOLTAGE_ENABLED; a fault for cmd OPERATION ENABLED
    status_word:  0x0023  # SWITCHED ON - VOLTAGE_ENABLED
- desc:  "No voltage:  Supply voltage; fault is cleared"
  feedback_in:
    status_word:  0x0033  # SWITCHED ON + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0033  # SWITCHED ON + VOLTAGE_ENABLED
    fault:  False
    fault_desc:  ""
    goal_reason:  state SWITCHED ON (0x00000033) != OPERATION ENABLED
  sim_feedback:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
- desc:  "No voltage:  402 state machine transition 4"
  feedback_in:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    state:  OPERATION ENABLED
    transition:  4
    goal_reached:  True
    goal_reason:  Reached
- desc:  "No voltage:  Hold state OPERATION ENABLED"
  feedback_out:
    transition:  -1

#
# Controller commands homing operation
# command_mode -> MODE_HM
# control_word set OPERATION_MODE_SPECIFIC_1 (HOMING_START) bit
# status_word HOMING_COMPLETED bit set
# OPERATION ENABLED -> SWITCH ON DISABLED
- desc:  "Home:  command home_request & MODE_HM"
  command_in:
    # Controller commands homing start
    home_request:  True
  command_out:
    control_mode:  6  # MODE_HM
  sim_feedback:
    control_mode_fb:  6  # MODE_HM
- desc:  "Home:  Drive MODE_HM;  Command HOMING_START"
  feedback_in:
    control_mode_fb:  6  # MODE_HM
  feedback_out:
    control_mode_fb:  6  # MODE_HM
    transition:  -1
    goal_reached:  False
    goal_reason:  homing not complete
  command_out:
    control_word:  0x001F  # OPERATION ENABLED + HOMING_START
  sim_feedback:
    status_word:  0x1037  # OPERATION ENABLED + HOMING_ATTAINED
- desc:  "Home:  HOMING_ATTAINED & home_success set; Command no home_request"
  feedback_in:
    status_word:  0x1037  # OPERATION ENABLED + HOMING_ATTAINED
  feedback_out:
    status_word:  0x1037  # OPERATION ENABLED + HOMING_ATTAINED
    home_success:  True
    goal_reached:  True
    goal_reason:  Reached
  command_in:
    home_request:  False
  command_out:
    control_word:  0x000F  # OPERATION ENABLED
    control_mode:  8  # MODE_CSP
  sim_feedback:
    control_mode_fb:  8  # MODE_CSP
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
- desc:  "Home:  Command disable"
  feedback_in:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    control_mode_fb:  8  # MODE_CSP
  feedback_out:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    control_mode_fb:  8  # MODE_CSP
    home_success:  False
  command_in:
    # Controller commands disable
    state:  SWITCH ON DISABLED
  command_out:
    control_word:  0x0002  # QUICK STOP ACTIVE
  sim_feedback:
    status_word:  0x0017  # QUICK STOP ACTIVE + VOLTAGE_ENABLED
- desc:  "Home:  402 state machine transition 11"
  feedback_in:
    status_word:  0x0017  # QUICK STOP ACTIVE + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0017
    state:  QUICK STOP ACTIVE
    transition:  11
    goal_reached:  False
    goal_reason:  state QUICK STOP ACTIVE (0x00000017) != SWITCH ON DISABLED
  command_out:
    control_word:  0x0000  # SWITCH ON DISABLED
  sim_feedback:
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED
- desc:  "Home:  402 state machine transition 12"
  feedback_in:
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED
    state:  SWITCH ON DISABLED
    transition:  12
    goal_reached:  True
    goal_reason:  Reached
- desc:  "Home:  Hold SWITCH ON DISABLED x1"
  feedback_out:
    transition:  -1
- desc:  "Home:  Hold SWITCH ON DISABLED x2"

#
# Command PP-mode move
#
- desc:  "PP move:  Command OPERATION ENABLED and MODE_PP"
  command_in:
    # Controller commands enable
    state:  OPERATION ENABLED
    control_mode:  1  # MODE_PP
  command_out:
    control_word:  0x0006
    control_mode:  1  # MODE_PP
  sim_feedback:
    status_word:  0x0431  # READY TO SWITCH ON + VOLTAGE_ENABLED + TARGET_REACHED
    control_mode_fb:  1  # MODE_PP
- desc:  "PP move:  402 state machine transition 2"
  feedback_in:
    status_word:  0x0431  # READY TO SWITCH ON + VOLTAGE_ENABLED + TARGET_REACHED
    control_mode_fb:  1  # MODE_PP
  feedback_out:
    status_word:  0x0431  # READY TO SWITCH ON + VOLTAGE_ENABLED + TARGET_REACHED
    control_mode_fb:  1  # MODE_PP
    state:  READY TO SWITCH ON
    transition:  2
    goal_reached:  False
    goal_reason:  state READY TO SWITCH ON (0x00000431) != OPERATION ENABLED
  command_out:
    control_word:  0x0007
  sim_feedback:
    status_word:  0x0433  # SWITCHED ON + VOLTAGE_ENABLED + TARGET_REACHED
- desc:  "PP move:  402 state machine transition 3"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    position_fb:  15.0  # Move isn't complete
    status_word:  0x0433  # SWITCHED ON + VOLTAGE_ENABLED + TARGET_REACHED
  feedback_out:
    position_fb:  15.0  # Move isn't complete
    status_word:  0x0433  # SWITCHED ON + VOLTAGE_ENABLED + TARGET_REACHED
    state:  SWITCHED ON
    transition:  3
    goal_reason:  state SWITCHED ON (0x00000433) != OPERATION ENABLED
  command_out:
    control_word:  0x000F
  sim_feedback:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
- desc:  "PP move:  402 state machine transition 4; command move_request"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0037  # OPERATION ENABLED + VOLTAGE_ENABLED
    state:  OPERATION ENABLED
    transition:  4
    goal_reached:  True
    goal_reason:  Reached
  command_in:
    # Controller commands move setpoint
    move_request:  True
  command_out:
    control_word:  0x001F  # Bit 4 NEW_SETPOINT set
  sim_feedback:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
- desc:  "PP move:  Wait for move (1)"
  sim_feedback_set:
    position_fb:  10.0  # Move isn't complete
  feedback_in:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
    position_fb:  10.0  # Move isn't complete
  feedback_out:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
    transition:  -1
    goal_reached:  False
    goal_reason:  move not complete
    position_fb:  10.0  # Move isn't complete
  command_out:
    control_word:  0x000F  # Bit 4 NEW_SETPOINT clear
  sim_feedback:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
- desc:  "PP move:  Wait for move (2)"
  sim_feedback_set:
    position_fb:  5.0  # Move isn't complete
  feedback_in:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
    position_fb:  5.0  # Move isn't complete
  feedback_out:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
    position_fb:  5.0  # Move isn't complete
- desc:  "PP move:  Wait for move (3)"
  sim_feedback_set:
    position_fb:  0.0  # Move complete
  feedback_in:
    position_fb:  0.0  # Move complete
  feedback_out:
    position_fb:  0.0  # Move complete
  sim_feedback:
    status_word:  0x0437  # Bit 10 TARGET_REACHED set
- desc:  "PP move:  Move complete"
  feedback_in:
    status_word:  0x0437  # Bit 10 TARGET_REACHED set
  feedback_out:
    status_word:  0x0437  # Bit 10 TARGET_REACHED set
    goal_reached:  True
    goal_reason:  Reached
    move_success:  True
- desc:  "PP move:  Cancel move request"
  command_in:
    # Controller cancels move setpoint command
    move_request:  False
- desc:  "PP move:  Hold state"
  feedback_out:
    move_success:  False

#
# Command PP-mode move, interrupted by fault
#
- desc:  "PP move FAULT:  Command move_request"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    position_fb:  15.0  # Move isn't complete
  feedback_out:
    position_fb:  15.0  # Move isn't complete
  command_in:
    # Command move setpoint
    move_request:  True
  command_out:
    control_word:  0x001F  # Bit 4 NEW_SETPOINT set
  sim_feedback:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
- desc:  "PP move FAULT:  Hold state; wait"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
  feedback_out:
    status_word:  0x1037  # Bit 12 SETPOINT_ACKNOWLEDGE set
    transition:  -1
    goal_reached:  False
    goal_reason:  move not complete
  command_out:
    control_word:  0x000F  # Bit 4 NEW_SETPOINT clear
  sim_feedback:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
- desc:  "PP move FAULT:  Controller commands FAULT"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
  feedback_out:
    status_word:  0x0037  # Bit 12 SETPOINT_ACKNOWLEDGE clear
  command_in:
    state:  FAULT
  command_out:
    control_word:  0x0002  # Bits 0,2,3 SWITCH_ON QUICK_STOP ENABLE_OPERATION cleared
  sim_feedback:
    status_word:  0x0017  # QUICK_STOP_ACTIVE + VOLTAGE_ENABLED
- desc:  "PP move FAULT:  QUICK STOP ACTIVE"
  sim_feedback_set:
    position_fb:  15.0  # Move isn't complete
  feedback_in:
    status_word:  0x0017  # QUICK_STOP_ACTIVE + VOLTAGE_ENABLED
  feedback_out:
    status_word:  0x0017  # QUICK_STOP_ACTIVE + VOLTAGE_ENABLED
    state:  QUICK STOP ACTIVE
    transition:  11
    fault: True
    fault_desc:  Move request while drive not enabled
    goal_reason:  state QUICK STOP ACTIVE (0x00000017) != FAULT; Move request while drive not enabled
    move_error:  True
  command_out:
    control_word:  0x0000  # Bit 1 ENABLE_VOLTAGE cleared
  sim_feedback:
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED - SETPOINT_ACK
- desc:  "PP move FAULT:  SWITCH ON DISABLED; cancel move request"
  command_in:
    # Cancel PP move setpoint
    move_request:  False
  command_out:
    control_word:  0x0000  # Bit 4 OPERATION_MODE_SPECIFIC_1/NEW_SETPOINT cleared
  feedback_in:
    position_fb:  0.0  # Move complete
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED - SETPOINT_ACK
  feedback_out:
    position_fb:  0.0  # Move complete
    status_word:  0x0050  # SWITCH ON DISABLED + VOLTAGE_ENABLED - SETPOINT_ACK
    state:  SWITCH ON DISABLED
    transition:  12
    goal_reason:  Move request while drive not enabled
- desc:  "PP move FAULT:  Done"
  feedback_out:
    transition:  -1
    fault:  False
    fault_desc:  ""
    goal_reached:  True
    goal_reason:  Reached
    move_error:  False
  sim_feedback:
    status_word:  0x0450
- desc:  "PP move FAULT:  Hold"
  feedback_in:
    status_word:  0x0450
  feedback_out:
    status_word:  0x0450
- desc:  "PP move FAULT:  Hold"
